
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Power ratings &#8212; UEFA Women&#39;s Euro 2022</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Group odds from betting lines" href="GetGroupOdds.html" />
    <link rel="prev" title="UEFA Women’s Euro 2022" href="intro.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/uefa.jpeg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">UEFA Women's Euro 2022</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    UEFA Women’s Euro 2022
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Power ratings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="GetGroupOdds.html">
   Group odds from betting lines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="SimEuro.html">
   Simulation
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/executablebooks/jupyter-book/master?urlpath=tree/docs/PowerRatings.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/executablebooks/jupyter-book"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FPowerRatings.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="_sources/PowerRatings.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reshaping-the-data">
   Reshaping the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-data">
   Setting up the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-the-power-ratings">
   Computing the power ratings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-computation">
   Example computation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-ratings">
   Saving the ratings
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Power ratings</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#reshaping-the-data">
   Reshaping the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setting-up-the-data">
   Setting up the data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#computing-the-power-ratings">
   Computing the power ratings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-computation">
   Example computation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#saving-the-ratings">
   Saving the ratings
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="power-ratings">
<h1>Power ratings<a class="headerlink" href="#power-ratings" title="Permalink to this headline">#</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>We’ll build the power ratings using the following data, which contains scores from UEFA women’s soccer teams in the last three years of Euro qualification and World Cup qualification.  There are 388 matches in this dataset.  The dataset also contains odds for most of those games from <a class="reference external" href="https://oddspedia.com/football/world/world-cup-women-qualification#odds">oddspedia.com</a>, but we won’t use those odds to make these power ratings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">factorial</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;data/scores_and_odds.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>home_team</th>
      <th>away_team</th>
      <th>home_score</th>
      <th>away_score</th>
      <th>tournament</th>
      <th>home_odds</th>
      <th>draw_odds</th>
      <th>away_odds</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2019-08-29</td>
      <td>Israel</td>
      <td>Italy</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>UEFA Euro qualification</td>
      <td>3000.0</td>
      <td>1600.0</td>
      <td>-2000.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2019-08-29</td>
      <td>Lithuania</td>
      <td>Croatia</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>UEFA Euro qualification</td>
      <td>2150.0</td>
      <td>900.0</td>
      <td>-1000.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2019-08-29</td>
      <td>Faroe Islands</td>
      <td>Wales</td>
      <td>0.0</td>
      <td>6.0</td>
      <td>UEFA Euro qualification</td>
      <td>3300.0</td>
      <td>1200.0</td>
      <td>-1429.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2019-08-29</td>
      <td>Denmark</td>
      <td>Malta</td>
      <td>8.0</td>
      <td>0.0</td>
      <td>UEFA Euro qualification</td>
      <td>-10000.0</td>
      <td>1825.0</td>
      <td>4200.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2019-08-29</td>
      <td>Iceland</td>
      <td>Hungary</td>
      <td>4.0</td>
      <td>1.0</td>
      <td>UEFA Euro qualification</td>
      <td>-714.0</td>
      <td>760.0</td>
      <td>1625.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>383</th>
      <td>2022-06-27</td>
      <td>Georgia</td>
      <td>Republic of Ireland</td>
      <td>0.0</td>
      <td>9.0</td>
      <td>FIFA World Cup qualification</td>
      <td>8400.0</td>
      <td>8900.0</td>
      <td>-5000.0</td>
    </tr>
    <tr>
      <th>384</th>
      <td>2022-06-28</td>
      <td>Netherlands</td>
      <td>Belarus</td>
      <td>3.0</td>
      <td>0.0</td>
      <td>FIFA World Cup qualification</td>
      <td>-1000.0</td>
      <td>4000.0</td>
      <td>9900.0</td>
    </tr>
    <tr>
      <th>385</th>
      <td>2022-06-28</td>
      <td>Estonia</td>
      <td>Kazakhstan</td>
      <td>4.0</td>
      <td>2.0</td>
      <td>FIFA World Cup qualification</td>
      <td>275.0</td>
      <td>240.0</td>
      <td>153.0</td>
    </tr>
    <tr>
      <th>386</th>
      <td>2022-06-28</td>
      <td>Moldova</td>
      <td>Lithuania</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>FIFA World Cup qualification</td>
      <td>530.0</td>
      <td>310.0</td>
      <td>-145.0</td>
    </tr>
    <tr>
      <th>387</th>
      <td>2022-06-28</td>
      <td>Ukraine</td>
      <td>Hungary</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>FIFA World Cup qualification</td>
      <td>220.0</td>
      <td>275.0</td>
      <td>170.0</td>
    </tr>
  </tbody>
</table>
<p>388 rows × 9 columns</p>
</div></div></div>
</div>
<p>There are 24 teams in the 2022 Women’s Euro tournament, but our data also includes European teams which did not qualify.  There are 51 total teams in our data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;home_team&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">size</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>51
</pre></div>
</div>
</div>
</div>
<p>We are going to estimate a value for each of the following parameters.</p>
<ul class="simple">
<li><p>A rating <code class="docutils literal notranslate"><span class="pre">r_team</span></code> for each team.</p></li>
<li><p>A home field advantage rating <code class="docutils literal notranslate"><span class="pre">hfa</span></code>.</p></li>
<li><p>An additive constant <code class="docutils literal notranslate"><span class="pre">b</span></code>.</p></li>
</ul>
<p>The standard power ratings for American football teams (at least the power ratings I know) can be immediately interpreted in terms of spreads in games.  The values here are less easy to interpet, but as a first impression, the higher the rating, the stronger the team is considered.</p>
</div>
<div class="section" id="reshaping-the-data">
<h2>Reshaping the data<a class="headerlink" href="#reshaping-the-data" title="Permalink to this headline">#</a></h2>
<p>It will be easier to get equations from our data if we reshape it, so that there is a column for each team.  Each game will also correspond to two rows: one row from the perspective of the home team, and one row from the perspective of the away team.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">])</span>

<span class="n">df_data1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">home_team</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">away_team</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
<span class="n">df_data1</span><span class="p">[</span><span class="s2">&quot;HFA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df_data1</span><span class="p">[</span><span class="s2">&quot;const&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df_data1</span><span class="p">[</span><span class="s2">&quot;days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2022-07-06&quot;</span><span class="p">)</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
<span class="n">df_data1</span><span class="p">[</span><span class="s2">&quot;Goals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;home_score&quot;</span><span class="p">]</span>

<span class="n">df_data2</span> <span class="o">=</span> <span class="o">-</span><span class="n">df_data1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_data2</span><span class="p">[</span><span class="s2">&quot;HFA&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">df_data2</span><span class="p">[</span><span class="s2">&quot;const&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">df_data2</span><span class="p">[</span><span class="s2">&quot;days&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2022-07-06&quot;</span><span class="p">)</span><span class="o">-</span><span class="n">df</span><span class="o">.</span><span class="n">date</span><span class="p">)</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">days</span>
<span class="n">df_data2</span><span class="p">[</span><span class="s2">&quot;Goals&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;away_score&quot;</span><span class="p">]</span>

<span class="n">df_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df_data1</span><span class="p">,</span> <span class="n">df_data2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Here is the DataFrame we just made.  (The code above might be difficult to understand, but the same thing could be made for example using a for loop, where you iterate over each match from <code class="docutils literal notranslate"><span class="pre">df</span></code>.)</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Albania</th>
      <th>Armenia</th>
      <th>Austria</th>
      <th>Azerbaijan</th>
      <th>Belarus</th>
      <th>Belgium</th>
      <th>Bosnia-Herzegovina</th>
      <th>Bulgaria</th>
      <th>Croatia</th>
      <th>Cyprus</th>
      <th>...</th>
      <th>Spain</th>
      <th>Sweden</th>
      <th>Switzerland</th>
      <th>Turkey</th>
      <th>Ukraine</th>
      <th>Wales</th>
      <th>HFA</th>
      <th>const</th>
      <th>days</th>
      <th>Goals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1042</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1042</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>1</td>
      <td>1</td>
      <td>1042</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1042</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1042</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>383</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>9</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>384</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>385</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
      <td>2.0</td>
    </tr>
    <tr>
      <th>386</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>387</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>8</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>776 rows × 55 columns</p>
</div></div></div>
</div>
<p>Let’s focus on two of the rows, both from the same game.  In this game, Moldova was home against Romania.  (<strong>Warning</strong>. It’s possible that in this dataset, some teams are incorrectly identified as home teams when it was at a neutral location.)</p>
<p>In the two rows displayed below, the top row is from Moldova’s perspective.  The match was played on June 24, 2022, and the 12 in the “days” column refers to the number of days before the start of the Euro tournament.  This match ended 0-4, with Moldova losing to Romania.</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pd</span><span class="o">.</span><span class="n">option_context</span><span class="p">(</span><span class="s1">&#39;display.max_columns&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
    <span class="n">display</span><span class="p">(</span><span class="n">df_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">380</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Albania</th>
      <th>Armenia</th>
      <th>Austria</th>
      <th>Azerbaijan</th>
      <th>Belarus</th>
      <th>Belgium</th>
      <th>Bosnia-Herzegovina</th>
      <th>Bulgaria</th>
      <th>Croatia</th>
      <th>Cyprus</th>
      <th>Czech Republic</th>
      <th>Denmark</th>
      <th>England</th>
      <th>Estonia</th>
      <th>Faroe Islands</th>
      <th>Finland</th>
      <th>France</th>
      <th>Georgia</th>
      <th>Germany</th>
      <th>Greece</th>
      <th>Hungary</th>
      <th>Iceland</th>
      <th>Israel</th>
      <th>Italy</th>
      <th>Kazakhstan</th>
      <th>Kosovo</th>
      <th>Latvia</th>
      <th>Lithuania</th>
      <th>Luxembourg</th>
      <th>Malta</th>
      <th>Moldova</th>
      <th>Montenegro</th>
      <th>Netherlands</th>
      <th>North Macedonia</th>
      <th>Northern Ireland</th>
      <th>Norway</th>
      <th>Poland</th>
      <th>Portugal</th>
      <th>Republic of Ireland</th>
      <th>Romania</th>
      <th>Russia</th>
      <th>Scotland</th>
      <th>Serbia</th>
      <th>Slovakia</th>
      <th>Slovenia</th>
      <th>Spain</th>
      <th>Sweden</th>
      <th>Switzerland</th>
      <th>Turkey</th>
      <th>Ukraine</th>
      <th>Wales</th>
      <th>HFA</th>
      <th>const</th>
      <th>days</th>
      <th>Goals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>380</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>12</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>380</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>-1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>12</td>
      <td>4.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="setting-up-the-data">
<h2>Setting up the data<a class="headerlink" href="#setting-up-the-data" title="Permalink to this headline">#</a></h2>
<p>In the eventual formula, we will always subtract the opponent’s power rating, so there are not uniquely determined “best” power ratings (if you add 4 to each power rating, you will end up with the exact same predictions).  To normalize things, we will remove Albania from the computation (which is equivalent to forcing Albania to have a power rating of 0).</p>
<p>We will also remove the “days” column (because we will not solve for that), and we will remove the “goals” column, because that is our target.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind_cols</span> <span class="o">=</span> <span class="n">df_data</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to estimate a value for each of the following.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind_cols</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Armenia&#39;, &#39;Austria&#39;, &#39;Azerbaijan&#39;, &#39;Belarus&#39;, &#39;Belgium&#39;,
       &#39;Bosnia-Herzegovina&#39;, &#39;Bulgaria&#39;, &#39;Croatia&#39;, &#39;Cyprus&#39;, &#39;Czech Republic&#39;,
       &#39;Denmark&#39;, &#39;England&#39;, &#39;Estonia&#39;, &#39;Faroe Islands&#39;, &#39;Finland&#39;, &#39;France&#39;,
       &#39;Georgia&#39;, &#39;Germany&#39;, &#39;Greece&#39;, &#39;Hungary&#39;, &#39;Iceland&#39;, &#39;Israel&#39;, &#39;Italy&#39;,
       &#39;Kazakhstan&#39;, &#39;Kosovo&#39;, &#39;Latvia&#39;, &#39;Lithuania&#39;, &#39;Luxembourg&#39;, &#39;Malta&#39;,
       &#39;Moldova&#39;, &#39;Montenegro&#39;, &#39;Netherlands&#39;, &#39;North Macedonia&#39;,
       &#39;Northern Ireland&#39;, &#39;Norway&#39;, &#39;Poland&#39;, &#39;Portugal&#39;,
       &#39;Republic of Ireland&#39;, &#39;Romania&#39;, &#39;Russia&#39;, &#39;Scotland&#39;, &#39;Serbia&#39;,
       &#39;Slovakia&#39;, &#39;Slovenia&#39;, &#39;Spain&#39;, &#39;Sweden&#39;, &#39;Switzerland&#39;, &#39;Turkey&#39;,
       &#39;Ukraine&#39;, &#39;Wales&#39;, &#39;HFA&#39;, &#39;const&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<p>Our computation method is based on NumPy objects, not pandas DataFrames, so we take the desired columns from <code class="docutils literal notranslate"><span class="pre">df_data</span></code> and convert the result to a NumPy array.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="n">ind_cols</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As our initial guess, we will initialize all of the values to 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ind_cols</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
       1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
       1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1., 1.,
       1.])
</pre></div>
</div>
</div>
</div>
<p>We removed the “days” column and the “Goals” column from our DataFrame above.  Let’s get access to these values, and again convert to NumPy objects.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">days</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;days&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">goals</span> <span class="o">=</span> <span class="n">df_data</span><span class="p">[</span><span class="s2">&quot;Goals&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="computing-the-power-ratings">
<h2>Computing the power ratings<a class="headerlink" href="#computing-the-power-ratings" title="Permalink to this headline">#</a></h2>
<p>Our computation is of the parameter values is based on Section 3.3 of <a class="reference external" href="https://www.researchgate.net/publication/325683270_Prediction_of_the_FIFA_World_Cup_2018_-_A_random_forest_approach_with_an_emphasis_on_estimated_team_ability_parameters">Prediction of the FIFA World Cup 2018</a> by Groll, Ley, Schauberger, Eetvelde.  (<strong>Warning</strong>.  The point of that paper is to suggest a better approach than what we are doing here.)</p>
<p>The following function represents (the negative logarithm of) equation (5) from that section.  (The formula looks very complicated, but most of the complication comes from the Poisson distribution.  Getting from the Poisson distribution to this formula is not as difficult.)  We initially parametrized <code class="docutils literal notranslate"><span class="pre">X</span></code> to be an array of all 1s.  We want to find the value of <code class="docutils literal notranslate"><span class="pre">X</span></code> which minimizes the following.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">h</span></code> represents how much we emphasize recent games.  The smaller the value of <code class="docutils literal notranslate"><span class="pre">h</span></code>, the more we emphasize recent games.  This value of 60 is quite small.  Even a value like 1000 would be reasonable.  Among smallish values (less than one year, 365), 60 seemed to perform the best in my testing, but it is admittedly not a well-motivated choice.  Large values like 1000 also performed similarly well.  You could get a more “pure” rating and a slightly simpler equation by removing this dependence on days completely.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span> <span class="o">=</span> <span class="mi">60</span>

<span class="k">def</span> <span class="nf">log_likelihood</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">-</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="n">days</span><span class="o">/</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">X1</span><span class="o">*</span><span class="n">goals</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">factorial</span><span class="p">(</span><span class="n">goals</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">X1</span><span class="p">)))</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>With this setup, it is surprisingly easy to get parameter estimates for <code class="docutils literal notranslate"><span class="pre">X</span></code>.</p>
<p>We imported the <code class="docutils literal notranslate"><span class="pre">minimize</span></code> function from SciPy at the top of this notebook.  (Unfortunately I can’t locate the blog post where I learned how to do this in Python.  I know <a class="reference external" href="https://journals.sagepub.com/doi/full/10.1177/1471082X18817650">this article</a> by several of the same authors explicitly mentions the BFGS algorithm that we specify.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">log_likelihood</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BFGS&#39;</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;disp&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully.
         Current function value: 82.573450
         Iterations: 90
         Function evaluations: 6148
         Gradient evaluations: 116
</pre></div>
</div>
</div>
</div>
<p>Here are the computed power ratings.  Notice that the home-field advantage parameter and the additive constant are mixed in with the country ratings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">ind_cols</span><span class="p">)</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>England                1.818341
Spain                  1.805690
Belgium                1.564538
Sweden                 1.486001
Italy                  1.432286
Netherlands            1.398150
Iceland                1.363971
Scotland               1.218321
Norway                 1.215415
Austria                1.211231
Republic of Ireland    1.193398
Germany                1.159227
Switzerland            1.094898
France                 1.081583
Serbia                 0.895214
Poland                 0.879161
Denmark                0.749340
Romania                0.639400
Northern Ireland       0.637515
Russia                 0.572936
Finland                0.564222
Wales                  0.542317
Slovenia               0.509966
Slovakia               0.450723
Czech Republic         0.415839
Belarus                0.328000
Portugal               0.319649
HFA                    0.278229
Ukraine                0.180158
Hungary                0.143349
Greece                 0.045646
Croatia               -0.025680
const                 -0.032447
Bosnia-Herzegovina    -0.091075
Kosovo                -0.108551
Israel                -0.138964
Turkey                -0.246921
Lithuania             -0.278453
Azerbaijan            -0.304917
Malta                 -0.396945
Estonia               -0.620776
Montenegro            -0.624960
Luxembourg            -0.666782
Latvia                -0.673109
Cyprus                -0.711888
North Macedonia       -0.713501
Moldova               -0.774991
Kazakhstan            -0.846161
Bulgaria              -0.862780
Faroe Islands         -1.057288
Georgia               -1.059363
Armenia               -1.262190
dtype: float64
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="example-computation">
<span id="id1"></span><h2>Example computation<a class="headerlink" href="#example-computation" title="Permalink to this headline">#</a></h2>
<p>The above calculations are based on modeling the number of goals scored (by a single team) using a <a class="reference external" href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson distribution</a>.  To describe a Poisson distribution, all that is needed is to specify the mean <span class="math notranslate nohighlight">\(\lambda\)</span>.  The above power ratings relate to this <span class="math notranslate nohighlight">\(\lambda\)</span> by the following formula, which is equation (4) in the above mentioned paper <a class="reference external" href="https://www.researchgate.net/publication/325683270_Prediction_of_the_FIFA_World_Cup_2018_-_A_random_forest_approach_with_an_emphasis_on_estimated_team_ability_parameters">Prediction of the FIFA World Cup 2018</a>.</p>
<div class="math notranslate nohighlight">
\[
\log(\lambda) = b+r_1-r_2+\text{hfa}.
\]</div>
<p>Here is a quick example of how to use these ratings.  Say we want to estimate how many goals will be scored if the Netherlands plays at home against Denmark.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;const&quot;</span><span class="p">]</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Netherlands&quot;</span><span class="p">]</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;Denmark&quot;</span><span class="p">]</span>
<span class="n">hfa</span> <span class="o">=</span> <span class="n">ratings</span><span class="p">[</span><span class="s2">&quot;HFA&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Here is our estimate for the expected number of goals scored by the Netherlands.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam_neth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r1</span><span class="o">-</span><span class="n">r2</span><span class="o">+</span><span class="n">hfa</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam_neth</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.446335638651978
</pre></div>
</div>
</div>
</div>
<p>The same thing for Denmark.  (In this computation, we leave out homefield advantage.)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam_dk</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">b</span><span class="o">+</span><span class="n">r2</span><span class="o">-</span><span class="n">r1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam_dk</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.5059809113680493
</pre></div>
</div>
</div>
</div>
<p>If instead we want to know, what is the probability that the Netherlands wins against Denmark at home, we can simulate for example 10,000,000 matches as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rng</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">default_rng</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="mi">7</span>
<span class="n">scores</span> <span class="o">=</span> <span class="n">rng</span><span class="o">.</span><span class="n">poisson</span><span class="p">(</span><span class="n">lam</span><span class="o">=</span><span class="p">(</span><span class="n">lam_neth</span><span class="p">,</span> <span class="n">lam_dk</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>For example, in the first 3 matches in our simulation, the Netherlands won all three, with scores of 2-0, 7-1, and 3-0.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scores</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[2, 0],
       [7, 1],
       [3, 0]])
</pre></div>
</div>
</div>
</div>
<p>Here is the probability corresponding to all ten million matches in the simulation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">scores</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8019058
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">scores</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0581204
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">count_nonzero</span><span class="p">(</span><span class="n">scores</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">scores</span><span class="p">[:,</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.1399738
</pre></div>
</div>
</div>
</div>
<p>Our simulation suggests an 80% chance that the Netherlands wins, a 6% chance that Denmark wins, and a 14% chance that the match ends in a draw.</p>
</div>
<div class="section" id="saving-the-ratings">
<h2>Saving the ratings<a class="headerlink" href="#saving-the-ratings" title="Permalink to this headline">#</a></h2>
<p>We’ll save the ratings in a csv file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratings</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;data/ratings.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="intro.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">UEFA Women’s Euro 2022</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="GetGroupOdds.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Group odds from betting lines</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Christopher Davis<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>